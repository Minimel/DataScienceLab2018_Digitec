# Improving Shopping at Galaxus-Digitec - Data Science Lab

The goal of this project is to provide clients of Digitec/Galaxus with a reduced set of products that fits their criteria
as fast as possible, by choosing the best sequence of questions/filters to ask.

The different steps of our project are describes here. Details on how to access the data from the virtual machine are explained further down.

## Our Models

### Stage 1 - Max Mutual Information Algorithm ('greedy' file)
Max_MI algorithm: Greedy algorith that selects the next question/filter by maximizing the varying component of the mutual entropy.
Baseline algorithm: Next question/filter asked is chosen randomly from the set available questions in the updates product subset.

For the MAx_MI algorithm, run `greedy/evaluation_eliminate.py`\\
Arguments that can be added are
- -s (number of products to test on)
- -hist (Boolean to indicate whether to use history data)
- -a (parameter to determine the importance given to history data)
- -pidk (probability of user answering I don't know to a question)
- -p2a (probability of user giving 2 answers to a question)
- -p3a (probability of user giving 3 answers to a question)
The results obtained will be compared with the random baseline

### Stage 2 - Imitation Learning ('dagger' file)
We used imitation learning (an alternative to reinforcement learning for learning sequential decision-making policies) to
train our model to choose the most appropriate next question/filter, using the data generated by our greedy Max MI algoritm.\\

Run `dagger/dagger_main.py`


## Access to the Data
### Access the Machine
- Send SSH public key to be added to the authorized users.
- User: dslab
- IP Adress: 35.240.23.69
- First time:
    - `sudo echo "35.240.23.69 dslab-vm" >> /etc/hosts` your local machine
- Next times:
    - Access ports on the VM: `ssh -L 8888:localhost:8888 dslab2@104.155.100.66 `
    - Access jupyter notebook:  `localhost:8888` in browser

### Access to Database
- Log in to the machine
- psql -d dslab dslab (Login to db dslab with user dslab)
    - PW: dslab2018

Execute queries directly here
- \dt to list tables
- \d+ tablename to view schema

Access to database from Python (using sqlalchemy):
    - `engine = sqlalchemy.create_engine('postgresql://dslab:dslab2018@localhost/dslab')`

### Preloaded Data
- Three tables:
    - traffic = One request to our Backend Webservers per row
    - product_purchase = One row for each Product and Property Combination (also note: a PropertyValueId only makes sense in combination with a PropertyTypeId)
    - product = Each row is a purchased product; if multiples of the same product is purchased in one order it is still one row.

(Note: In case the db breaks there is a jupyter notebook ready to import all the data again into the notebook)
